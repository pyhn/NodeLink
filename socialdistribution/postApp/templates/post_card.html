{% load static %}


<!-- Replace word with icons later -->

<div class="post info">
    <!-- Post Meta Information -->
    <!-- Post Title -->
    <a  href="{% url 'authorApp:profile_display' post.author.user.username%}"><div class='user_img'><img src="{{profileImg}}"></div></a>
    <div class="user_info">
        <h1>{{post.title}}</h1>
        <span class="user_icon"></span><!--!!!add anchor to user account-->
        <div class="post-meta"><!--!!!add link yo user profile-->
            By <a  href="{% url 'authorApp:profile_display' post.author.user.username%}">{{ post.author.user.username }}</a> on {{ post.created_at|date:"F j, Y, g:i a" }}
            | Visibility: {{ post.get_visibility_display }}
        </div>
    </div>


</div>
<div class="post body">
    <a href="{%url 'postApp:post_detail' post.uuid%}" target="_parent">

            {% if post_content %}
            <div class="post content">
                {% if post.contentType == 'c' %}
                    {{ post_content|safe|linebreaks }}
                {% else %}
                    {{ post_content|linebreaks }}
                {% endif %}

            </div>
            {% endif %}


        <!-- Post Image -->
        {% if post.img %}
        <div class="post img">
            <img src="{{ post.img.url }}" alt="Post Image">
        </div>
        {% endif %}
    </a>
</div>
<div class="post bottom_bar">
    <!-- Display the number of likes -->
    <div class="like-count">
        {{ post.postliked.count }} {{ post.postliked.count|pluralize:"Like,Likes" }}
    </div>
    <!-- Like/Unlike Button -->
    <div class="icon-button">


        {% if user_has_liked == False%}
        <form action="{% url 'postApp:like_post' post.uuid %}" method="post">
            {% csrf_token %}
            <button id='post-like-{{post.uuid}}' class='icon' type="submit"><img
                    src="{% static 'icons/plain_heart.svg' %}" alt="like button"></button>
        </form>
        {%else%}
        <span class='icon'><img src="{% static 'icons/filled_heart.svg' %}"
            alt="unlike button"></span>
        {% endif %}
    </div>


    <!-- Share button -->
    {% if post.visibility == 'p' %}
        <div class="icon-button">
            {% csrf_token %}
            <!-- Clicking the button triggers HTMX request to load the share form via GET request to share_post into the
             shareModel structure (popup)-->
            <button class="icon" type="button"
                    hx-get="{% url 'postApp:render_share_form' author_serial=post.author.user.username post_uuid=post.uuid %}"
                    hx-target="#shareModalContent"
                    hx-trigger="click"
                    hx-swap="innerHTML">
                <img src="{% static 'icons/send.svg' %}" alt="send button">
            </button>
    </div>
    {% endif %}

    <!-- Modal Structure -->
    <div id="shareModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <div id="shareModalContent">
                <!-- Content loaded via HTMX -->
            </div>
        </div>
    </div>
</div>
<script src="https://unpkg.com/htmx.org"></script>

    <!-- Modal JavaScript -->
    <script>
    function closeModal() {
        document.getElementById('shareModal').style.display = 'none';
    }

    // Show modal when content is loaded via HTMX
    document.addEventListener('htmx:afterSwap', (e) => {
        if (e.detail.target.id === 'shareModalContent') {
            document.getElementById('shareModal').style.display = 'block';
        }
    });

    // Close modal when clicking outside of the modal content
    window.onclick = function(event) {
        const modal = document.getElementById('shareModal');
        if (event.target == modal) {
            closeModal();
        }
    };
    </script>
